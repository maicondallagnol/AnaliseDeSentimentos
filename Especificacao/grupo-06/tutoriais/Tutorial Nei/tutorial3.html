<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>:: Sistemas Orientados a Objetos 2020 - Prof. Dr. Frank J. Affonso</title>
        <link rel="stylesheet" href="../../../foundation-sites-6.6.3-CSS/assets/css/foundation.css" />        
        <link rel="stylesheet" href="../../../foundation-sites-6.6.3-CSS/assets/css/app.css" />
    </head>

    <body>
        <!-- TOPO DA PÁGINA-->
        <div id="topo">
            <div class="background">
                <div class="grid-container">
                    <div class="grid-x grid-margin-x">
                        <div class="cell small-10">&nbsp;</div>
                        <div class="cell small-2">
                            <p class="right marginTop"><button class="button warning expanded" data-open="exampleModal1">Sobre</button></p>

                            <div class="reveal" id="exampleModal1" data-reveal>
                                <h1>Guia para Documentação</h1>
                                <p class="lead">Prof. Dr. Frank J. Affonso.</p>
                                <p>Projeto criado com ZURB Foundation 6.6.3.</p>
                                <button class="close-button" data-close aria-label="Close modal" type="button">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                        </div>

                        <div class="cell small-12">
                            <div class="heigh100">                    
                            </div>
                        </div>
                        <div class="cell small-12">
                            <h2 class="whiteBold">Sistemas Orientados a Objetos 2020</h2>
                            <h3 class="white">Atividades Remotas</h3>
                            <h4 class="white">Prof. Frank J. Affonso</h4>
                        </div>                                           
                    </div>
                </div> 
            </div>
        </div>
        <!-- TOPO DA PÁGINA-->


        <!-- CORPO DA PÁGINA-->        
        <div id="corpo">
            <div class="grid-container">
                <div class="grid-x grid-margin-x">
                    <div class="cell small-12 heigh50">
                        &nbsp;
                    </div>

                    <div class="cell small-12">
                        <div class="callout">
                            <div class="cell small-12">
                                <h1> Desenvolvendo Restful API com Spring Boot.</h1>
                            </div>
                            <div class="cell small-12">
                                <hr>                    
                            </div>
                            <div class="cell small-12">
                                <p class="bold"> GRUPO: 2 </p>
                            </div>                                
                            <div class="cell small-12">                    
                                <ul>
                                    <li>Maicon Nei</li>
                                    <li>Gustavo Marinho</li>
                                    <li>Guilherme Caes</li>
                                </ul>
                            </div>

                            <div class="cell small-12">
                                <hr>                    
                            </div>

                            <div class="cell small-12">
                                <p class="bold"> Pré-requisitos </p>
                            </div>                      
                            <div class="cell small-12">
                                <ul class="vertical menu">
                                    <li><a href="https://www.oracle.com/technetwork/pt/java/javase/downloads/index.html">Java 8 ou superior - Versão 11.0.5 LTS</a></li>
                                    <li><a href="https://www.jetbrains.com/idea/download/">IntelliJ IDEA Community (Recomendado)</a></li>
                                </ul>
                            </div>                            
                        </div>
                    </div> 

                    <!--collout-->
                    <div class="cell small-12">
                        &nbsp;                    
                    </div>
                    <div class="cell small-12">                                
                        <h3> Objetivo</h3>
                        <hr>
                        <p> 
                            O objetivo principal desse projeto é inicializar um projeto Spring utilizando o Spring Boot e construir 
                            APIs RESTFul para demonstrar os principais tipos de requisição HTTP utilizadas nessas aplicações.
                            Como objetivo secundário, irei inserir a ferramenta Swagger-UI como dependência do projeto para ajudar a
                            documentar e visualizar as APIs e realizar requisições para nossos endpoints.
                        </p>
                    </div>

                    <div class="cell small-12">
                        &nbsp;                    
                    </div>
                    <div class="cell small-12">                                
                        <h3> Um pouco sobre conceitos</h3>
                        <hr>
                        <h4>O que é Spring Boot?</h4>
                        <p> 
                            Spring Boot é uma ferramenta que visa facilitar e otimizar o processo de configuração de aplicações
                            Spring fornencendo a maior parte dos componentes de forma pré-configurada. O objetivo é possibilitar
                            a publicação de aplicações em produção de maneira rápida. Por meio do 
                            <a href="https://start.spring.io/" target="_blank">Spring Initializr</a> é possível gerar        
                            um projeto Maven ou Gradle pré-configurado selecionando todas as dependências e módulos que serão necessárias
                            para o desenvovlimento da sua aplicação.
                        </p>

                        <h4>O que é REST?</h4>  
                        <p>
                            REST (Representational State Transfer) significa Transferência de Estado Representacional. É uma abstração da arquitetura 
                            web e define um conjunto de constantes e regras para criação de serviços web.
                            Uma API REST é uma interface de dados que fornece dados baseados em requisições HTTP utilizando <b>verbos</b> para definir sua finilidade 
                            (GET, POST, PUT, DELETE). De modo geral o corpo dessas requisições é um <b>JSON</b>.
                            <br>Um exemplo divertido de visualizar os HTTP status: <a href="https://http.cat/">https://http.cat/</a>
                            <img class="float-center" src="imagem/http.jpeg " width="400" height="500" alt="imagem-02"/>

                        </p>
                    </div>

                    <div class="cell small-12">
                        &nbsp;                    
                    </div>
                    <div class="cell small-12">                                
                        <h3> Apresentando o Exemplo</h3>
                        <hr>
                        <p> 
                            Para demonstrar algumas APIs REST desenvolvidas no tutorial 3, considere
                            a espeficicação abaixo:
                        </p>

                        <div class="callout fundoEspRequisitos">
                            <p>
                                O sistema ao ser inicializado, deve expor na <a href="http://localhost:8081/swagger-ui.html#/">URL</a>
                                uma interface de documentação de APIs que deverá conter 4 endpoints documentados.
                                Os endpoints devem manipular um objeto Book (representa um livro) que deverá ter os atributos: 
                                id e nome.
                                São os endpoints: <br>
                                GET /v1/books/all que retornará todos os livros na base de dados <br>
                                GET /v1/books/{id} que retornará somente o livro com o id solicitado<br>
                                POST /v1/books que cadastrará um novo livro<br>
                                PUT /v1/books/{id} que atualizará um livro na base<br>
                            </p>
                        </div>
                    <div class="cell small-12">
                        <div class="callout fundoAzul">
                            <h3 class="center">
                                PARTE 1: Criação do projeto utilizando Spring Initializr
                            </h3>
                        </div>
                    </div>

                    <div class="cell small-12">
                        <h3> Criando o projeto</h3>
                        <hr>
                        <p> 
                            Pelo site <a href="https://start.spring.io/" target="_blank">https://start.spring.io/</a>, iremos gerar um projeto base que
                            será utilizado para desenvolvermos nossas APIs.
                            Devemos selecionar as seguintes opções no Initializr:
                        </p>
                        <ul>
                            <li>
                                Maven project
                            </li>
                            <li>
                                Java
                            </li>
                            <li>
                                Spring Boot 2.3.2
                            </li>
                            <li>
                                Packing JAR
                            </li>   
                            <li>
                                Java 8
                            </li>
                        </ul>

                        <p>
                           Inicialmente, devemos adicionar as seguintes dependências no projeto:
                        </p>
                        <ul>
                            <li>
                                H2 Database
                            </li>
                            <li>
                                Spring Data JPA
                            </li>
                            <li>
                                Lombok
                            </li>
                            <li>
                                Spring Boot DevTools
                            </li>   
                        </ul>

                        <img class="float-center" src="imagem/initializr.png " width="1031" height="937" alt="imagem-02"/>

                        <br>
                        <br>
                        <p>
                            Após a seleção de todos os componentes basta baixar o zip, descompacta-lo e abri-lo como um projeto Gradle na sua IDE.
                            Recomendo e utilizarei o <b>Intellij</b> no tutorial 3.
                        </p>                     
                    </div>

                    <div class="cell small-12">
                        &nbsp;                    
                    </div>
                    <div class="cell small-12">                                
                        <h3> Implementação</h3>
                        <hr>

                        <h4>Primeiros passos na estrutura do projeto</h4>
                        <p> 
                            Inicialmente, vamos criar a estrutura de pastas que iremos utiliazar.
                            Como a arquitetura do software não é o foco do tutorial, irei adotar uma arquitetura simples de três
                            camadas: Controller, Service e Repository.

                            Ficamos então dessa forma:
                        </p>
                        <p>
                            <img class="float-center" src="imagem/structure.png" width="450" height="200" alt="imagem-03"/> 
                        </p>
                        <p>
                            Dentro da pasta <i>src/main/java/com.example.tutorial3</i> foram criadas algumas pastas que serão utilizadas ao longo do tutorial:
                                <ul>
                                    <li>
                                        <b>config</b> - Onde ficarão classes de configuração como por exemplo a classe SwaggerConfig.
                                    </li>
                                    <li>
                                        <b>controller</b> - Pacote onde ficarão os Controllers da aplicação, que serão as interfaces de entrada para das requisições HTTP.
                                    </li>
                                    <li>
                                        <b>entity</b> - Pacote onde ficarão as entidades utilizadas na aplicação. No caso do tutorial 3 a entidade Book.
                                    </li>
                                    <li>
                                        <b>repository</b> - Pacote onde ficarão classes de repositório.
                                    </li>
                                    <li>
                                        <b>service</b> - Pacote onde ficarão classes de serviço que concentrarão as lógicas de negócio de casos de uso da aplicação.
                                    </li>
                                </ul>
                        </p>

                        <p>
                            Dentro da pasta <i>resources</i>, o projeto virá com o arquivo <i>application.properties</i>. Irei renomea-lo para application.yml para facilitar a inserção de informações 
                            de configuração. Ainda dentro da pasta resources, irei inserir um arquivo chamado data com extensão <i>sql</i>. Irei explica-lo logo abaixo.
                            A pasta resource ficará da seguinte maneira: 
                        </p>
                        <p>
                            <img class="float-center" src="imagem/resources.png" width="450" height="200" alt="imagem-03"/> 
                        </p>
                        </div>                        
                        <div class="cell small-12">   
                            <h4>Classes e arquivos de configurações</h4>
                            <h5>H2 Database</h5>
                            <p>Inicialmente, iremos realizar a configuração do H2 Database que é um banco de dados em memória que adicionamos nas depependências do projeto.
                                No arquivo application.yml, iremos inserir algumas informações que permitirão a aplicação identificar o H2 como datasource e também habilitar um console
                                do H2 que poderá facilitar na visualização de dados durante a execução dos exemplos e comprovação de conceitos.
                                Sendo assim, devemos inserir o seguinte bloco no arquivo yml:
                            </p>
                                <pre>
spring:
    datasource:
        url: jdbc:h2:mem:testdb
        driverClassName: org.h2.Driver
        username: h2
        password: h2
    h2:
        console:
            enabled: true
                                </pre>
                            

                                <h5>Swagger UI</h5>
                                <p>O Swagger UI é uma ferramenta para documentação de APIs que disponibiliza uma ferramenta com interface gráfica
                                    que facilita muito a forma de fazer as requisições e visualizar os models, payloads e reponses das APIs documentadas.
                                    Para inseri-lo no projeto, teremos de adiciona-lo nas dependênciasdo gradle, visto que ele não estava disponível no site do
                                    Initializr para pré-configuração do projeto.
                                </p>

                                <p>Para isso, vamos seguir os passos:</p>

                                <li>Abrir o arquivo <i>build.gradle</i>
                                <li>Copiar o trecho de código: <pre>
                                    implementation 'io.springfox:springfox-swagger2:2.9.2'
                                    implementation 'io.springfox:springfox-swagger-ui:2.9.2'
                                </pre></i>
                                <li>Inserir dentro de <i>dependencies</i>, como na imagem:</li>

                                <p>
                                    <img class="float-center" src="imagem/dependencies.png" width="750" height="420" alt="imagem-03"/> 
                                </p>

                                <p>A partir daí, o Gradle irá baixar as dependências do Swagger.</p>

                                <p>Agora, dentro da do package de config, devemos criar uma classe chamada SwaggerConfig.java
                                    que será anotado como @Configuration para que o Spring utilize o resolva como classe de configuração e possamos utilizar a interface
                                    gráfica de documentação de APIs.
                                </p>
                                
                                <textarea rows="47" cols="20">
package com.example.tutorial3.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@Configuration
@EnableSwagger2
public class SwaggerConfig extends WebMvcConfigurationSupport {

        @Bean
        public Docket greetingApi() {
            return new Docket(DocumentationType.SWAGGER_2)
                .groupName("Tutorial 3")
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.example.tutorial3"))
                .build()
                .apiInfo(apiInfo());
        }

        private ApiInfo apiInfo() {
            return new ApiInfoBuilder()
                .title("Tutorial 3")
                .description("Spring Boot RESTFul APIs ")
                .version("1.0.0")
                .license("PROPRIETARY")
                .build();
        }

        @Override
        protected void addResourceHandlers(final ResourceHandlerRegistry registry) {
            registry.addResourceHandler("swagger-ui.html")
                .addResourceLocations("classpath:/META-INF/resources/");

            registry.addResourceHandler("/webjars/**")
                .addResourceLocations("classpath:/META-INF/resources/webjars/");
        }
}
                                </textarea>
                                <p>
                                    <h4>Implementação das APIs</h4>
                                </p>
                                <p>Iremos implementar 3 classes que farão o fluxo de dados da nossa API: Controller, Service e Repository.  
                                Cada uma delas dentro de seu respectivo package e seguindo boas práticas, com um sulfixo.
                                Também iremos implementar uma classe de Entidade que servirá de modelo para as requisições.<br>
                                Normalmente, são utilizados padrões de VO/DTO para implementar a transferência de dados entre a camada REST e 
                                as outras camadas da aplicação, porém, como não é meu objetivo me aprofundar em nenhum design pattern, utilizei 
                                a entidade como corpo de requisição de algumas APIs.
                                </p>

                                <h5>Entity</h5>
                                <textarea rows="23" cols="20">
package com.example.tutorial3.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import javax.persistence.Entity;
import javax.persistence.Id;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Entity(name = "BOOK")
public class Book {
    @Id
    private Long id;

    private String name;
}
                                    </textarea>

                                <h5>Controller</h5>
                                <textarea rows="47" cols="20">
package com.example.tutorial3.con
import com.example.tutorial3.entity.Book;
import com.example.tutorial3.service.BookService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import lombok.RequiredArgsConstructor;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Optional;

@RestController
@Api(value = "This endpoint returns manipulates all info about books")
@RequiredArgsConstructor
@RequestMapping(value = "/v1/books", produces = MediaType.APPLICATION_JSON_VALUE)
public class BookController {

    private final BookService bookService;

    @ApiOperation(value = "Get all books")
    @GetMapping(value = "/all")
    public List<Book> findAllBooks() {
        return bookService.findAllBooks();
    }

    @ApiOperation(value = "Get a book by its id")
    @GetMapping(value = "/{id}")
    public Optional<Book> findBookById(@PathVariable Long id) {
        return bookService.findBookById(id);
    }

    @ApiOperation(value = "Create a new book")
    @PostMapping
    public Book createUser(@RequestBody Book book) {
        return bookService.createBook(book);
    }

    @ApiOperation(value = "Updates book")
    @PutMapping
    public Book updateUser(@RequestBody Book book) {
        return bookService.updateBook(book);
    }
}
                                </textarea>
                                <h5>Service</h5>
                                <textarea rows="37" cols="20">
package com.example.tutorial3.
import com.example.tutorial3.entity.Book;
import com.example.tutorial3.repository.BookRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Optional;

@Service
@RequiredArgsConstructor
public class BookService {

    @Autowired
    BookRepository repository;

    public List<Book> findAllBooks() {
        return repository.findAll();
    }

    public Optional<Book> findBookById(Long id) {

        return repository.findById(id);
    }

    public Book createBook(Book book) {
        return repository.save(book);
    }

    public Book updateBook(Book book) {
        Optional<Book> byId = repository.findById(book.getId());
        byId.get().setName(book.getName());
        return repository.save(byId.get());
    }
}                                  
                                </textarea>
                                <h5>Repository</h5>
                                <textarea rows="12" cols="20">
package com.example.tutorial3.repository;

import com.example.tutorial3.entity.Book;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface BookRepository extends JpaRepository<Book, Long> {

}
                                </textarea>

                                <p>
                                    <h4>Testando as APIs pelo Swagger-UI e H2 Console</h4>
                                </p>

                                <p>Executando a aplicação, acesse a <a href="http://localhost:8081/swagger-ui.html#/">URL</a>. Você encontrar a página que foi documentadas
                                    pela classe do SwaggerConfig e os endpoints que foram referenciados com as anotações do swagger na classe BookController.class.                            
                                </p>

                        <div>
                            <img class="float-center" src="imagem/swagger.png" width="1920" height="805" alt="imagem-03"/> 
                        </div>
                    </div>   
                    
                    <p> Ao clicar no book-controller, teremos acesso a todos os endpoints documentados na classe BookController e
                        podemos testar as requisições.
                    </p>

                    <div>
                        <img class="float-center" src="imagem/swagger1.png" width="1920" height="805" alt="imagem-03"/> 
                    </div>
                    <p> Após selecionar uma das APIs (recomendo a API de Get All Books para primeiro teste), basta clicar em <b>"Try it out"</b>
                        e em em seguida clicar em execute. O Swagger exibirá o código de retorno da requisição.
                    </p>
                    <div>
                        <img class="float-center" src="imagem/swagger2.png" width="1920" height="805" alt="imagem-03"/> 
                    </div> 
                    <div>
                        <img class="float-center" src="imagem/swagger3.png" width="1920" height="805" alt="imagem-03"/> 
                    </div>

                    <p><b>OBS: </b>Como havia mencionado anteriormente, no setup do H2 Database, criamos um arquivo <i>data.sql</i>
                    que terá scripts com massa de dados que serão inseridos no banco em memória sempre que a aplicação for executada.
                    Isso possibilitará que o teste com o GET /all Books retorne alguns dados que já estarão inseridos na aplicação,
                    sem que haja necessidade de inserção de dados por meio do método POST para que algum GET retorne algum dado.</p>

                    <p>Outra maneira de visualizar a massa de dados e inserção/atualização dos dados além dos métodos GET, seria utilizar o console
                        do H2 Database que habilitamos inserindo a config no arquivo <i>application.yml</i><br>
                        Acessando a <a href="http://localhost:8081/h2-console/">URL</a>, é possível visualizar a tela de login para o console do H2.<br>
                    </p>

                    <div>
                        <img class="float-center" src="imagem/h2console1.png" width="500" height="400" alt="imagem-03"/> 
                    </div>

                    <p>Inserindo os dados de login inserindos no <i>application.yml</i> é possível logar no console</p>
                    <pre>
                        username: h2
                        password: h2
                    </pre>
                    <div>
                        <img class="float-center" src="imagem/h2console2.png" width="1920" height="805" alt="imagem-03"/> 
                    </div>
                    <div class="cell small-12">
                        <div class="callout">
                            <div class="grid-container">
                                <div class="grid-x grid-margin-x">
                                    <div class="cell small-9 bold">Download do projeto </div>
                                    <div class="cell small-3">
                                        <a href="arquivos/tutorial3.zip" class="hollow button float-center">Clique aqui</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                            </div>
                        </div>           
                    </div>
                </div>
            </div>

        

            <!-- CORPO DA PÁGINA-->

            <!-- RODAPÉ DA PÁGINA-->
            <div id="rodape">
                <div  class="fundoCinza5px"> &nbsp; </div>
                <!-- INSERINDO CARDS..-->
                <div  class="fundoPreto">
                    <div class="fundoPreto20px">

                    </div>

                    <div class="grid-container">
                        <div class="grid-x grid-margin-x">
                            <div class="cell small-12">
                                <p class="whiteBold"> REFERÊNCIAS </p>
                                <hr>
                                <p><a class="white" href="https://spring.io/projects/spring-framework" target="_blank">Spring Framework</a>  </p>
                                <p><a class="white" href="https://start.spring.io/" target="_blank">Spring Initializr </a>  </p>
                                <p><a class="white" href="https://www.jetbrains.com/idea/download/" target="_blank">Download IntelliJ</a>  </p>
                                <p><a class="white" href="https://www.totvs.com/blog/developers/rest/" target="_blank"> Publicação Totvs sobre Rest</a>  </p>
                                <p><a class="white" href="https://swagger.io/tools/swagger-ui/" target="_blank"> Swagger UI</a>  </p>
                                <p><a class="white" href="https://projectlombok.org/" target="_blank">Lombok</a>  </p>
                                <p>&nbsp;</p>
                            </div>                        
                        </div>
                    </div>                
                </div>
            </div>
            <!-- RODAPÉ DA PÁGINA-->

            <script src="../../../foundation-sites-6.6.3-CSS/assets/js/vendor.js"></script>
            <script src="../../../foundation-sites-6.6.3-CSS/assets/js/foundation.js"></script>
            <script>
                $(document).foundation();
            </script>

    </body>
</html>